<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/general :: header}">
</head>
<body>
<div class="container-fluid">
    <header th:insert="~{fragments/navbars :: common-nav}">
    </header>

    <main class="mt-3">
        <hr class="bg-exodia hr-2"/>
        <h1 class="text-center text-exodia">Create Auction</h1>
        <hr class="bg-exodia w-25 hr-2"/>
        <form class="mx-auto w-50" th:method="post" th:action="@{/auctions/create}"
              enctype="multipart/form-data" >


            <div class="form-group" th:classappend="${#fields.hasErrors('auctionCreateModel.name')} ? 'text-danger'">
                <label for="name">Name</label>
                <input type="text" class="form-control"
                       th:field="${auctionCreateModel.name}"  th:value="${auctionCreateModel.name}"
                       id="name" placeholder="Name..." name="name">

                <small id="usernameHelp"
                       th:each="error : ${#fields.errors('auctionCreateModel.name')}" th:utext="${error +'<br>'}">
                </small>
            </div>

            <div class="row justify-content-between">
                <div class="col-5" th:classappend="${#fields.hasErrors('auctionCreateModel.type')} ? 'text-danger'">

                    <label for="auctionType">Type</label>
                    <select name="type" class="form-control" id="auctionType" th:field="${auctionCreateModel.type}">
                        <option th:each="auctionType : ${T(beginfunc.domain.entities.enums.AuctionType).values()}"
                                th:value="${auctionType}" th:text="${auctionType}"
                                th:selected="${#strings.equals(auctionCreateModel.getType(), auctionType) ? true : false}">
                        </option>
                    </select>
                    <small id="typeHelp"
                           th:each="error : ${#fields.errors('auctionCreateModel.type')}" th:utext="${error +'<br>'}">
                    </small>
                </div>

                <div class="col-2">
                    <div class="row">
                        <label class="form-check-label" for="isStartLater">
                            Start later?
                        </label>
                    </div>
                    <div class="row justify-content-center">
                        <input name="startLater" class="form-check-input" th:field="${auctionCreateModel.startLater}" type="checkbox"
                             th:checked="${#bools.isTrue(auctionCreateModel.startLater)? true : false}" id="isStartLater">
                    </div>
                </div>

                <div class="col-5" th:classappend="${#fields.hasErrors('auctionCreateModel.category')} ? 'text-danger'">

                    <label for="category">Select category</label>
                    <select name="category" class="form-control" id="category" th:field="${auctionCreateModel.category}"
                            onChange="showCollectionFields()">
                        <option th:each="category : ${categories}"
                                th:value="${category.name}" th:text="${category.name}"
                                th:selected="${#strings.equals(auctionCreateModel.category, category.name) ? true : false}">
                        </option>
                    </select>
                    <small id="categoryHelp"
                           th:each="error : ${#fields.errors('auctionCreateModel.category')}" th:utext="${error +'<br>'}">
                    </small>
                </div>
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('auctionCreateModel.description')} ? 'text-danger'">
                <label for="auctionDescription">Description</label>
                <textarea name="description" class="form-control" th:field="${auctionCreateModel.description}"
                          id="auctionDescription" rows="3"><th:block th:text="${auctionCreateModel.description}"></th:block></textarea>
                <small
                        th:each="error : ${#fields.errors('auctionCreateModel.description')}" th:utext="${error +'<br>'}">
                </small>
            </div>

            <div class="row justify-content-between">
                <div class="col-5" th:classappend="${#fields.hasErrors('auctionCreateModel.town')} ? 'text-danger'">
                    <label for="town">Town</label>
                    <input type="text" class="form-control"
                           th:field="${auctionCreateModel.town}"  th:value="${auctionCreateModel.town}"
                           id="town" placeholder="Town..." name="town">

                    <small id="townHelp"
                           th:each="error : ${#fields.errors('auctionCreateModel.town')}" th:utext="${error +'<br>'}">
                    </small>
                </div>

                <div class="col-5" th:classappend="${#fields.hasErrors('auctionCreateModel.wantedPrice')} ? 'text-danger'">
                    <label for="wantedPrice">Price</label>
                    <input type="number" step="0.01" class="form-control"
                           th:field="${auctionCreateModel.wantedPrice}"  th:value="${auctionCreateModel.wantedPrice}"
                           id="wantedPrice" placeholder="Price..." name="wantedPrice">

                    <small id="wantedPriceHelp"
                           th:each="error : ${#fields.errors('auctionCreateModel.wantedPrice')}" th:utext="${error +'<br>'}">
                    </small>
                </div>
            </div>

            <div id="collectionFields" class="mt-3" style="display: none">
                <h1 class="text-center text-exodia" id="collectionTitle">Coin specifications:</h1>

                <div class="row">
                    <div class="col-5" th:classappend="${#fields.hasErrors('coin.yearOfIssue')} ? 'text-danger'">
                        <label for="yearOfIssue">Year of issue</label>
                        <input type="number" step="1" class="form-control"
                               th:field="${coin.yearOfIssue}"
                               id="yearOfIssue" placeholder="Year..." name="yearOfIssue">

                        <small id="yearOfIssueHelp"
                               th:each="error : ${#fields.errors('coin.yearOfIssue')}" th:utext="${error +'<br>'}">
                        </small>
                    </div>
                    <div class="col-2"></div>

                    <div class="col-5" th:classappend="${#fields.hasErrors('coin.grade')} ? 'text-danger'">
                        <label for="grade">Preservation Grade</label>
                        <select name="grade" class="form-control" id="grade" th:field="${coin.grade}">
                            <option th:each="grade : ${T(beginfunc.domain.entities.enums.PreservationGrade).values()}"
                                    th:value="${grade}" th:text="${grade}"
                                    th:selected="${#strings.equals(auctionCreateModel.getType(), grade) ? true : false}">
                            </option>
                        </select>
                        <small id="gradeHelp"
                               th:each="error : ${#fields.errors('coin.grade')}" th:utext="${error +'<br>'}">
                        </small>
                    </div>
                </div>

                <div class="row">
                <div class="col-5" th:classappend="${#fields.hasErrors('coin.nominalValue')} ? 'text-danger'">
                    <label for="nominalValue">Nominal Value</label>
                    <input type="number" step="0.01" class="form-control" th:field="${coin.nominalValue}"
                           id="nominalValue" placeholder="Nominal..." name="nominalValue">

                    <small id="nominalValueHelp"
                           th:each="error : ${#fields.errors('coin.nominalValue')}" th:utext="${error +'<br>'}">

                    </small>
                </div>
                <div class="col-2"></div>
                <div class="col-5" th:classappend="${#fields.hasErrors('coin.country')} ? 'text-danger'">
                    <label for="country">Country</label>
                    <input type="text" class="form-control" th:field="${coin.country}"
                           id="country" placeholder="Country..." name="country">

                    <small id="countryHelp"
                           th:each="error : ${#fields.errors('coin.country')}" th:utext="${error +'<br>'}">
                    </small>
                </div>
            </div>

                <div id="coinSpecific" style="display: none" class="mb-5">
                    <div class="row justify-content-around" th:classappend="${#fields.hasErrors('coin.metal')} ? 'text-danger'">
                        <div class="col-5" >
                            <label for="metal">Metal</label>
                            <input type="text" class="form-control" th:field="${coin.metal}"
                                   id="metal" placeholder="Metal..." name="metal">

                            <small id="metalHelp"
                                   th:each="error : ${#fields.errors('coin.metal')}" th:utext="${error +'<br>'}">

                            </small>
                        </div>
                        <div class="col-2"></div>
                        <div class="col-2" th:classappend="${#fields.hasErrors('coin.weight')} ? 'text-danger'">
                            <label for="weight">Weight</label>
                            <input type="number" step="0.01" class="form-control" th:field="${coin.weight}"
                                   id="weight" placeholder="Weight..." name="weight">

                            <small id="weightHelp"
                                   th:each="error : ${#fields.errors('coin.weight')}" th:utext="${error +'<br>'}">
                            </small>
                        </div>

                        <div class="col-1"></div>
                        <div class="col-2"  th:classappend="${#fields.hasErrors('coin.diameter')} ? 'text-danger'">
                            <label for="diameter">Diameter</label>
                            <input type="number" step="0.01" class="form-control" th:field="${coin.diameter}"
                                   id="diameter" placeholder="Diam..." name="diameter">

                            <small id="diameterHelp"
                                   th:each="error : ${#fields.errors('coin.diameter')}" th:utext="${error +'<br>'}">

                            </small>
                        </div>
                    </div>
                </div>

                <div id="banknoteSpecific" style="display: none" class="mb-5">
                    <div class="row justify-content-around">
                        <div class="col-5" th:classappend="${#fields.hasErrors('banknote.width')} ? 'text-danger'">
                            <label for="width">Width</label>
                            <input type="number" step="1" class="form-control" th:field="${banknote.width}"
                                   id="width" placeholder="Width..." name="width">

                            <small id="widthHelp"
                                   th:each="error : ${#fields.errors('banknote.width')}" th:utext="${error +'<br>'}">

                            </small>
                        </div>
                        <div class="col-2"></div>
                        <div class="col-5" th:classappend="${#fields.hasErrors('banknote.length')} ? 'text-danger'">
                            <label for="length">Length</label>
                            <input type="number" step="1" class="form-control" th:field="${banknote.length}"
                                   id="length" placeholder="Length..." name="length">

                            <small id="lengthHelp"
                                   th:each="error : ${#fields.errors('banknote.length')}" th:utext="${error +'<br>'}">
                            </small>
                        </div>
                    </div>
                </div>


            </div>

            <label>Product main image</label>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="mainImage"
                       name="mainImage" accept="image/*" placeholder="Upload main image...">
                <label class="custom-file-label" for="mainImage"
                       th:text="${#bools.isTrue(session.productMainImage==null)} ? 'Upload file...' : 'Choose other...'">
                </label>
            </div>
            <div th:utext="${#bools.isTrue(session.productMainImage!=null)} ? ${'Selected file: '}
            + ${session.productMainImage.getName()+'<p></p>'}">
            </div>


            <label>Product images</label>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="files"
                       accept="image/*"
                       placeholder="Upload files..." name="files" multiple>
                <label class="custom-file-label"
                       for="files" th:text="${#bools.isTrue(session.productImages==null)} ? 'Upload files...' : 'Choose others...'"></label>
            </div>

            <div th:if="${#bools.isTrue(session.productImages!=null)}">
                <label>Selected files:</label>
                <p th:each="file, place : ${session.productImages}" th:text="${place.index+1} +' - '+ ${file.getName()}">
                </p>
            </div>


            <hr class="bg-exodia hr-2 mt-3"/>
            <div class="button-holder mt-4 d-flex justify-content-center">
                <button type="submit" class="btn bg-exodia text-white">Create</button>
            </div>



        </form>
        <hr class="bg-exodia hr-2 mt-5"/>
    </main>

    <script th:inline="javascript">

        $( document ).ready(function() {
            let auction = [[${auctionCreateModel}]];
            console.log(auction);
            let category=auction.category;
            console.log(category);
            if(category==='Coins' || category==='Banknotes' ){
                showCollectionFields();
            }
        });



        function showCollectionFields(){
            let element=document.getElementById('category');
            let category = element.options[element.selectedIndex].text;
            let collectionDiv = document.getElementById('collectionFields');

            if(category==='Coins'||category==='Banknotes'){
                $('#collectionTitle').empty();
                collectionDiv.style.display = "block";
                let coinSpecific=document.getElementById('coinSpecific');
                let banknoteSpecific=document.getElementById('banknoteSpecific');

                if(category==='Coins'){
                    $('#collectionTitle').append('Coin specifications:');
                    coinSpecific.style.display = "block";
                    banknoteSpecific.style.display = "none";
                }else {
                    $('#collectionTitle').append('Banknote specifications:');
                    coinSpecific.style.display = "none";
                    banknoteSpecific.style.display = "block";
                }

            }else {
                collectionDiv.style.display = "none";
            }
        }

        $('input[type="file"]').on('change', function () {
            let filenames = [];
            let files = document.getElementById('files').files;

            for (let i in files) {
                if (files.hasOwnProperty(i)) {
                    filenames.push(files[i].name);
                }
            }
            $(this).next('.custom-file-label').addClass("selected").html(filenames.join(', '));
        });

        $('#mainImage').on('change', function() {
            let fileName = $(this).val().split('\\').pop();
            $(this).next('.custom-file-label').addClass("selected").html(fileName);
        });
    </script>

    <footer th:replace="~{fragments/general :: footer}">
    </footer>
</div>

</body>
</html>